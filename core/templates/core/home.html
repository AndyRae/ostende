{% extends "core/base.html" %}
{% block title %}
  What's On
{% endblock title %}
{% block content %}


  <div class="hero hero-md bg-dark">
    <div class="hero-body">
      <h1>What's On</h1>
      <p>Example</p>
    </div>
  </div>

  <div id="whatson">

    <form class="input-group mt-2 mb-2">
          <input type="search" class="form-input" type="search" name="search" placeholder="Search" aria-label="Search" v-model="search_term">
          <button class="btn btn-primary input-group-btn" v-on:click.prevent="getScreenings()">Submit</button>
    </form>

    {% if screenings %}

      <div class="columns mt-2">

          <div class="column col-4 mt-2" v-for="screening in screenings">
              <div class="card">
                <a class="card-image" :href="`screenings/${ screening.id }/`">
                  <img :src="`${ screening.film.image }`" class="img-responsive">
                </a>
                <div class="card-header">
                  <div class="card-title h5"><a :href="`screenings/${ screening.id }/`">${ screening.film.name }</a></div>
                  <div class="card-subtitle text-gray">${ screening.venue.name }, ${ screening.venue.city }</div>
                </div>
                <div class="card-body">
                  ${ screening.date } ${ screening.start_time }
                </div>
                <div class="card-footer">
                  <a :href="`${ screening.tickets }`" target="_blank" class="btn btn-primary">Buy tickets</a>
                </div>
              </div>
          </div>

      </div>

    {% else %}

      <p class="empty-title h5">There are no upcoming screenings</p>

    {% endif %}

  </div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.3.5"></script>

<script type="text/javascript">
  Vue.http.headers.common['X-CSRFToken'] = "{{ csrf_token }}";
   new Vue({
     el: '#whatson',
     delimiters: ['${','}'],
     data: {
       screenings: [],
       loading: true,
       message: null,
       search_term: '',
      },
      mounted: function() {
      this.getScreenings();
      },
       methods: {
         getScreenings: function() {
           let api_url = '/api/screening/';
           if(this.search_term!==''||this.search_term!==null) {
             api_url = `/api/screening/?search=${this.search_term}`
           }
           this.$http.get(api_url)
            .then((response) => {
            this.screenings = response.data;
           })
           .catch((err) => {
             console.log(err);
           })
          },
        }

  });
</script>

{% endblock content %}
