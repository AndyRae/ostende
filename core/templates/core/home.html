{% extends "core/base.html" %}
{% block title %}
  What's On
{% endblock title %}

{% block banner %}
  {% load static %}
  <div class="jumbotron jumbotron-fluid jumbotron-home banner mt-5 text-center" style="background-image: linear-gradient(#00000080, #0200007d), url({% static 'images/home.jpg' %});">
    <h1 class="display-3 text-white mt-5 font-weight-bold">Ostende</h1>
    <p class="lead text-white">An open source film season listing system, built with Python on Django.</p>
    <p class="lead">
      <a class="btn btn-dark btn-lg mt-4" href="#" role="button">Learn more</a>
    </p>
  </div>
{% endblock %}

{% block content %}
{% load thumbnail %}


<div id="whatson" class="mt-5">
  {% if screenings %}
  <h1 class="display-5 text-center">Upcoming Screenings</h1>

  <div class="row mt-5">
    <div class="col">

    </div>
    <div class="col-md-6">
      <form class="input-group mb-2">
            <input type="search" class="form-control" type="search" name="search" placeholder="Search by film, cinema, city... " aria-label="Search" v-model="search_term">
            <div class="input-group-append">
              <button class="btn btn-dark input-group-btn" v-on:click.prevent="getScreenings()">Search</button>
            </div>
      </form>

      <div class="text-center mt-3">
        <a href="{% url 'screening-month' %}" name="button" class="btn btn-dark">Next 30 Days</a>
        <input type="date" name="button" placeholder="date" v-model="search_term" class="btn btn-dark">
      </div>

    </div>
    <div class="col">

    </div>
  </div>



    <div class="row mt-5">
        <div class="col-sm-4" v-for="screening in screenings.slice(0, 9)">

          <div class="card mb-4">
            <a :href="`screenings/${ screening.id }/`" class="card-link">
              <img :src="`${ screening.film.image }`" class="card-img-top">
            </a>
            <div class="card-body">
              <div class="card-title h4"><a :href="`screenings/${ screening.id }/`">${ screening.film.name }</a></div>
              <div class="card-text text-secondary">${ screening.venue.name }, ${ screening.venue.city }</div>
              <div class="card-text text-secondary">${ screening.date } - ${ screening.start_time }</div>
              <a :href="`${ screening.tickets }`" target="_blank" class="btn btn-primary mt-3">Buy tickets</a>
            </div>
          </div>

        </div>
    </div>
    <div class="row mt-4 mb-5">
      <div class="col text-center">
          <a class="btn-lg btn-dark" href="{% url 'screenings' %}">Find more</a>
      </div>
    </div>
    <hr>


{% endif %}

</div>

<div class="mt-5">
  {% if articles %}
    <div class="row mt-5">
      {% for article in articles %}
        <div class="col-sm-6">
          <a class="card mb-5" href="{% url 'article-detail' article.slug article.id %}">
              <img src="{{ article.image|thumbnail_url:'panelThumb' }}" class="card-img-top card-article" alt="">
              <div class="card-body">
                <h4 class="card-title">{{ article.title }}</h4>
                <p class="card-text">{{ article.date }} // {{ article.author }}</p>
              </div>
          </a>
        </div>
      {% endfor %}
    </div>
    <div class="row mt-4 mb-5">
      <div class="col text-center">
          <a class="btn-lg btn-dark" href="{% url 'articles' %}">Find more</a>
      </div>
    </div>
  <hr>
  {% endif %}
</div>


<script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.3.5"></script>

<script type="text/javascript">
  Vue.http.headers.common['X-CSRFToken'] = "{{ csrf_token }}";
   new Vue({
     el: '#whatson',
     delimiters: ['${','}'],
     data: {
       screenings: [],
       message: null,
       search_term: '',
      },
      mounted: function() {
      this.getScreenings();
      },
       methods: {
         getScreenings: function() {
           let api_url = '/api/screening/';
           if(this.search_term!==''||this.search_term!==null) {
             api_url = `/api/screening/?search=${this.search_term}`
           }
           this.$http.get(api_url)
            .then((response) => {
            this.screenings = response.data;
           })
           .catch((err) => {
             console.log(err);
           })
          },
        }

  });
</script>

{% endblock content %}
