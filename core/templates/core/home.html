{% extends "core/base.html" %}
{% block title %}
  What's On
{% endblock title %}
{% block content %}

    <div class="hero hero-md bg-dark">
      <div class="hero-body">
        <h1>What's On</h1>
        <p>Example</p>
      </div>
    </div>
    <div class="input-group mt-2">
      <input type="text" class="form-input" placeholder="Location">
      <button class="btn btn-primary" onclick="getLocation()">Find It</button>
    </div>

{% if screenings %}

  <div id ="whatson" class="columns mt-2">

      <div class="column col-4 mt-2" v-for="screening in screenings">
          <div class="card">
            <div class="card-image">
              <img :src="`${ screening.film.image }`" class="img-responsive">
            </div>
            <div class="card-header">
              <div class="card-title h5"><a :href="`screenings/${ screening.slug }/${ screening.id }/`">${screening.film.name}</a></div>
              <div class="card-subtitle text-gray">${ screening.venue.name }, ${ screening.venue.county }</div>
            </div>
            <div class="card-body">
              ${ screening.date } ${ screening.start_time }
            </div>
            <div class="card-footer">
              <a :href="`${ screening.tickets }`" target="_blank" class="btn btn-primary">Buy tickets</a>
            </div>
          </div>
      </div>

  </div>


  {% else %}
    <div class="empty">
      <div class="empty-icon">
        <i class="icon icon-cross"></i>
      </div>
      <p class="empty-title h5">There are no upcoming screenings</p>
    </div>
  {% endif %}

<script type="text/javascript">
   new Vue({
     el: '#whatson',
     delimiters: ['${','}'],
     data: {
     screenings: [],
     loading: false,
     currentScreening: {},
     message: null,
   },
   mounted: function() {
     this.getScreenings();
  },
   methods: {
     getScreenings: function() {
   this.loading = true;
   this.$http.get('/api/screening/')
       .then((response) => {
         this.screenings = response.data;
         this.loading = false;
       })
       .catch((err) => {
        this.loading = false;
        console.log(err);
       })
  },
  }
  });
</script>

<script>
var x = document.getElementById("demo");

function getLocation() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(showPosition, showError);
  } else {
    x.innerHTML = "Geolocation is not supported by this browser.";
  }
}

function showPosition(position) {
  x.innerHTML = "Latitude: " + position.coords.latitude +
  "<br>Longitude: " + position.coords.longitude;
}

function showError(error) {
  switch(error.code) {
    case error.PERMISSION_DENIED:
      x.innerHTML = "User denied the request for Geolocation."
      break;
    case error.POSITION_UNAVAILABLE:
      x.innerHTML = "Location information is unavailable."
      break;
    case error.TIMEOUT:
      x.innerHTML = "The request to get user location timed out."
      break;
    case error.UNKNOWN_ERROR:
      x.innerHTML = "An unknown error occurred."
      break;
  }
}
</script>

{% endblock content %}
