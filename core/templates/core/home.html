{% extends "core/base.html" %}
{% block title %}
  What's On
{% endblock title %}
{% block content %}

<div class="">

</div>

<div id="whatson" class="mt-5">
  <h1 class="display-5 text-center">Upcoming Screenings</h1>

  <div class="row mt-5">
    <div class="col">

    </div>
    <div class="col-md-6">
      <form class="input-group mb-2">
            <input type="search" class="form-control" type="search" name="search" placeholder="Search by film, cinema, city... " aria-label="Search" v-model="search_term">
            <div class="input-group-append">
              <button class="btn btn-primary input-group-btn" v-on:click.prevent="getScreenings()">Search</button>
            </div>
      </form>
    </div>
    <div class="col">

    </div>
  </div>

  {% if screenings %}

    <div class="row mt-5">
        <div class="col-sm-4" v-for="screening in screenings">

          <div class="card mb-4">
            <a :href="`screenings/${ screening.id }/`">
              <img :src="`${ screening.film.image }`" class="card-img-top">
            </a>
            <div class="card-body">
              <div class="card-title h5"><a :href="`screenings/${ screening.id }/`">${ screening.film.name }</a></div>
              <div class="card-text">${ screening.venue.name }, ${ screening.venue.city }</div>
              <div class="card-text">${ screening.date } ${ screening.start_time }</div>
              <a :href="`${ screening.tickets }`" target="_blank" class="btn btn-primary mt-3">Buy tickets</a>
            </div>
          </div>

        </div>
    </div>

  {% else %}

    <p class="empty-title h5">There are no upcoming screenings</p>

  {% endif %}

</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.3.5"></script>

<script type="text/javascript">
  Vue.http.headers.common['X-CSRFToken'] = "{{ csrf_token }}";
   new Vue({
     el: '#whatson',
     delimiters: ['${','}'],
     data: {
       screenings: [],
       loading: true,
       message: null,
       search_term: '',
      },
      mounted: function() {
      this.getScreenings();
      },
       methods: {
         getScreenings: function() {
           let api_url = '/api/screening/';
           if(this.search_term!==''||this.search_term!==null) {
             api_url = `/api/screening/?search=${this.search_term}`
           }
           this.$http.get(api_url)
            .then((response) => {
            this.screenings = response.data;
           })
           .catch((err) => {
             console.log(err);
           })
          },
        }

  });
</script>

{% endblock content %}
