{% extends "core/base.html" %}

{% block og:title %}This Month{% endblock og:title %}
{% block twitter:title %}This Month{% endblock twitter:title %}

{% block og:image %}{% load static %}{% static 'images/home.jpg' %}{% endblock og:image %}
{% block twitter:image %}{% load static %}{% static 'images/home.jpg' %}{% endblock twitter:image %}

{% block title %}What's On{% endblock title %}

{% block content %}

  <h1 class="font-weight-bold mt-5">What's On This Month</h1>

  <div id="whatson" class="mt-5">
    {% if screenings %}
      <div class="row mt-5">
          <div class="col-sm-4" v-for="screening in screenings">

            <div class="card mb-4">
              <a :href="`/screenings/${ screening.id }/`" class="card-link">
                <img :src="`${ screening.film.image_thumbnail }`" class="card-img-top">
              </a>
              <div class="card-body">
                <div class="card-title h4"><a :href="`/screenings/${ screening.id }/`">${ screening.film.name }</a></div>
                <div class="card-text text-muted">${ screening.venue.name }, ${ screening.venue.city }</div>
                <div class="card-text text-muted">${ screening.date } - ${ screening.start_time }</div>
                <a :href="`${ screening.tickets }`" target="_blank" class="btn btn-outline-primary mt-3">Buy tickets</a>
              </div>
            </div>

          </div>
      </div>
    {% else %}
      <p>There are no screenings this month.</p>
      
    {% endif %}

      <hr>



  </div>

<script src="https://cdn.jsdelivr.net/npm/vue@2.5.13/dist/vue.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue-resource@1.3.5"></script>

<script type="text/javascript">
  Vue.http.headers.common['X-CSRFToken'] = "{{ csrf_token }}";
   new Vue({
     el: '#whatson',
     delimiters: ['${','}'],
     data: {
       screenings: [],
       message: null,
       urlparams: '',
      },
      mounted: function() {
      this.getScreenings();
      },
      methods: {
       getScreenings: function() {
         let api_url = '/api/screeningdate/';
         if(this.urlparams!==''||this.urlparams!==null) {
           api_url = `/api/screeningdate/`
         }
         this.$http.get(api_url)
          .then((response) => {
          this.screenings = response.data.results;
         })
         .catch((err) => {
           console.log(err);
         })
       },
      },

  });
</script>



{% endblock content %}
